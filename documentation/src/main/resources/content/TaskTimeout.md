# Управление временем выполнения задачи

Taskurotta отслеживает время за которое должна выполнится каждая задача. В случае если задача не была выполнена в срок, сервер ставит ее в очередь повторно. По умолчанию на задачу отводится 1 час времени. Этого может быть как недостаточно так и избыточно. В первом случае актеры будут вынуждены выполнять задачу повторно, а во втором случае при падении JVM актеров задача не будет выполнятся целый час, пока она повторно не окажется в очереди. Для решения этой проблемы есть два способа изменения таймаута для задачи. Один с помощью координатора, а второй непосредственно самим актером.

## Управление таймаутом с помощью координатора.

Координатор может прогнозировать время выполнения задачи и выставлять свойство timeout у конфигурации задачи. Например:

        TaskConfig options = new TaskConfig()
                .setStartTime(System.currentTimeMillis() + 100L)
                .setRetryPolicyConfig(retryPolicyConfig)
                .setTimeout(10000L);
                
        Promise<Double> sqrt = worker.sqrt(arg, options);
        
Таймаут выставляется в миллисекундах. В выше приведенном примере это 10 секунд. Это является предпочтительным способом если время выполнения обычно не большое. При больших интервалах мы можем получить длительное время ожидания и соответственно медленную реакцию если требуется повторная постановка задачи в очередь.

## Управление таймаутом с помощью актера

Актер может более точно прогнозировать время выполнения. Кроме того он может использовать возможность уточнения таймаута как аналог heartbeat. Пример:

        RuntimeContext.getCurrent().updateTimeout(10000L);

Таймаут выставляется в секундах. Необходимо заметить, что для уменьшения нагрузки на сервер, не будет происходить синхронное обращение к нему при вызове метода updateTimeout. Происходит только фиксация необходимости выполнения этой задачи. Поэтому актер может вызывать данный метод столько раз сколько нужно без опасения снизить производительность системы в целом. Обновление таймаута задач происходит асинхронно и по умолчанию один раз в десять минут. Без реальной необходимости не рекомендуется выполнять это чаще. Настраивается период обновления таймаута в yaml конфиге актеров. Пример:

      - FFWorker:
          actorInterface: ru.taskurotta.test.fullfeature.worker.FullFeatureWorker
          count: 25
          updateTimeoutInterval: 10 minutes

Значение указывается в формате "<число> <TimeUnit>s"

